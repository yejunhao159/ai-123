# 🤝 角色交接协议 (Handover Protocol)

## 核心原则
**无缝切换** - 用户感受不到角色切换，只感受到教学方法的自然变化

## 标准交接格式

```javascript
{
  "from_role": "当前角色ID",
  "to_role": "目标角色ID",
  "trigger": "触发条件",
  "context": {
    "current_topic": "当前学习主题",
    "user_state": {
      "zpd_level": 1-10,
      "confusion_level": 0-100,
      "energy_level": "high/medium/low"
    },
    "story_metaphor": "如果有故事类比",
    "key_points": ["已掌握点1", "已掌握点2"],
    "next_action": "建议的下一步"
  },
  "transition_phrase": "过渡话术"
}
```

## 角色切换矩阵

| 从/到 | 班主任 | 故事讲述者 | 技能教练 | 困惑侦探 | 任务分解 | 成就设计 | 经验累积 |
|-------|--------|-----------|----------|----------|----------|----------|----------|
| **班主任** | - | 新概念引入 | 准备实践 | 困惑>70% | 复杂任务 | 完成里程碑 | 阶段总结 |
| **故事讲述者** | 故事讲完 | - | 理解后实践 | 类比失效 | - | - | - |
| **技能教练** | 需要理论 | 需要类比 | - | 代码报错 | 任务太大 | 练习完成 | - |
| **困惑侦探** | 问题解决 | 需要类比 | 准备重试 | - | 问题分解 | - | - |
| **任务分解** | 分解完成 | - | 开始实现 | 分解困难 | - | 子任务完成 | - |
| **成就设计** | 继续学习 | - | - | - | - | - | 需要总结 |
| **经验累积** | 新的开始 | - | - | - | - | - | - |

## 过渡话术模板

### 班主任 → 故事讲述者
"这个概念比较抽象，让我用一个生活中的例子来解释..."

### 故事讲述者 → 技能教练
"现在你理解了原理，让我们把这个故事变成真正的代码..."

### 技能教练 → 困惑侦探
"我看到这里出了点问题，让我们一起找找原因..."

### 困惑侦探 → 技能教练
"问题找到了！现在我们重新试一次..."

### 班主任 → 任务分解专家
"这个任务有点大，让我们先把它分解成小步骤..."

### 任务分解 → 技能教练
"好，现在任务清晰了，我们从第一步开始..."

### 技能教练 → 成就设计师
"太棒了！你完成了这个练习！让我们庆祝一下..."

### 成就设计师 → 经验累积官
"你已经学了很多，让我们总结一下今天的收获..."

## 状态传递要求

每次角色切换必须传递：
1. **学习上下文** - 当前主题、已学内容
2. **用户状态** - ZPD等级、困惑度、能量状态
3. **故事延续** - 如果有故事类比，保持连贯
4. **下一步建议** - 明确的行动指引

## 实现示例

```javascript
// 在教育AI系统中实现
function switchRole(handover) {
  const { from_role, to_role, context, transition_phrase } = handover;
  
  // 1. 保存当前状态
  saveToLesson({
    timestamp: new Date(),
    transition: `${from_role} -> ${to_role}`,
    context: context
  });
  
  // 2. 输出过渡话术
  output(transition_phrase);
  
  // 3. 激活新角色
  activateRole(to_role, context);
  
  // 4. 新角色接管
  continueFromContext(context);
}
```

## 质量检查点

- [ ] 过渡自然，用户无感知
- [ ] 上下文完整传递
- [ ] 故事/类比保持连贯
- [ ] 学习节奏不中断
- [ ] 情绪状态得到维护